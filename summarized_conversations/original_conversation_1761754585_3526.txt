{'role': 'assistant', 'content': 'Let\'s create the services first, as they contain the business logic:\n\n<function_calls>\n<create-file file_path="src/services/finance/accountService.js">\nconst Account = require(\'../../models/finance/Account\');\nconst { AppError } = require(\'../../utils/helpers/errorHelper\');\nconst { calculateAccountBalance } = require(\'../../utils/calculators/balanceCalculator\');\nconst Transaction = require(\'../../models/finance/Transaction\');\n\n/**\n * Create a new account\n * @param {Object} accountData - Account data\n * @param {String} tenantId - Tenant ID\n * @returns {Object} Created account\n */\nconst createAccount = async (accountData, tenantId) => {\n  try {\n    // Add tenantId to account data\n    accountData.tenantId = tenantId;\n    \n    // Check if account with same code already exists\n    const existingAccount = await Account.findOne({\n      tenantId,\n      accountCode: accountData.accountCode\n    });\n    \n    if (existingAccount) {\n      throw new AppError(\'Account with this code already exists\', 409, \'DUPLICATE_ACCOUNT_CODE\');\n    }\n    \n    // Create new account\n    const account = new Account(accountData);\n    await account.save();\n    \n    return account;\n  } catch (error) {\n    if (error.code === 11000) {\n      throw new AppError(\'Account with this code already exists\', 409, \'DUPLICATE_ACCOUNT_CODE\');\n    }\n    throw error;\n  }\n};\n\n/**\n * Get all accounts with filters\n * @param {Object} filters - Filter criteria\n * @param {Object} pagination - Pagination options\n * @param {String} tenantId - Tenant ID\n * @returns {Object} Accounts and pagination info\n */\nconst getAccounts = async (filters, pagination, tenantId) => {\n  try {\n    const query = { tenantId, ...filters };\n    \n    // Handle active filter\n    if (filters.active !== undefined) {\n      query.isActive = filters.active;\n    }\n    \n    // Handle search\n    if (filters.search) {\n      query.$or = [\n        { accountName: { $regex: filters.search, $options: \'i\' } },\n        { accountCode: { $regex: filters.search, $options: \'i\' } }\n      ];\n    }\n    \n    const accounts = await Account.find(query)\n      .sort(pagination.sort || \'-createdAt\')\n      .skip(pagination.skip)\n      .limit(pagination.limit);\n    \n    const total = await Account.countDocuments(query);\n    \n    return {\n      accounts,\n      total,\n      page: pagination.page,\n      limit: pagination.limit\n    };\n  } catch (error) {\n    throw new AppError(\'Failed to fetch accounts\', 500, \'FETCH_ACCOUNTS_ERROR\');\n  }\n};\n\n/**\n * Get account by ID\n * @param {String} accountId - Account ID\n * @param {String} tenantId - Tenant ID\n * @returns {Object} Account\n */\nconst getAccountById = async (accountId, tenantId) => {\n  try {\n    const account = await Account.findOne({ accountId, tenantId });\n    \n    if (!account) {\n      throw new AppError(\'Account not found\', 404, \'ACCOUNT_NOT_FOUND\');\n    }\n    \n    return account;\n  } catch (error) {\n    if (error.name === \'CastError\') {\n      throw new AppError(\'Invalid account ID\', 400, \'INVALID_ACCOUNT_ID\');\n    }\n    throw error;\n  }\n};\n\n/**\n * Update account\n * @param {String} accountId - Account ID\n * @param {Object} updateData - Update data\n * @param {String} tenantId - Tenant ID\n * @returns {Object} Updated account\n */\nconst updateAccount = async (accountId, updateData, tenantId) => {\n  try {\n    const account = await Account.findOneAndUpdate(\n      { accountId, tenantId },\n      updateData,\n      { new: true, runValidators: true }\n    );\n    \n    if (!account) {\n      throw new AppError(\'Account not found\', 404, \'ACCOUNT_NOT_FOUND\');\n    }\n    \n    return account;\n  } catch (error) {\n    if (error.name === \'CastError\') {\n      throw new AppError(\'Invalid account ID\', 400, \'INVALID_ACCOUNT_ID\');\n    }\n    throw error;\n  }\n};\n\n/**\n * Get account balance\n * @param {String} accountId - Account ID\n * @param {String} tenantId - Tenant ID\n * @param {Date} asOfDate - Date to calculate balance as of\n * @returns {Object} Account balance details\n */\nconst getAccountBalance = async (accountId, tenantId, asOfDate = null) => {\n  try {\n    // Get account\n    const account = await Account.fi...\n The full message content is stored at /workspace/summarized_conversations/original_conversation_1761753920_4584.txt'}