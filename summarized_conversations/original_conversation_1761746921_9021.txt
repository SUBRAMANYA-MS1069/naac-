{'role': 'assistant', 'content': 'Let\'s continue creating more services:\n\n<function_calls>\n<create-file file_path="src/services/payroll/salaryStructureService.js">\nconst SalaryStructure = require(\'../../models/payroll/SalaryStructure\');\nconst { calculateGrossSalary } = require(\'../../utils/calculators/salaryCalculator\');\nconst { AppError } = require(\'../../utils/helpers/errorHelper\');\n\n/**\n * Create a new salary structure\n * @param {Object} structureData - Salary structure data\n * @param {String} tenantId - Tenant ID\n * @returns {Object} Created salary structure\n */\nconst createSalaryStructure = async (structureData, tenantId) => {\n  try {\n    // Add tenantId to structure data\n    structureData.tenantId = tenantId;\n    \n    // Calculate CTC\n    const totalEarnings = structureData.components.earnings.reduce((sum, component) => sum + (component.amount || 0), 0);\n    structureData.ctc = totalEarnings;\n    \n    // Create salary structure\n    const salaryStructure = new SalaryStructure(structureData);\n    await salaryStructure.save();\n    \n    return salaryStructure;\n  } catch (error) {\n    if (error.code === 11000) {\n      throw new AppError(\'Salary structure with this name already exists\', 409, \'DUPLICATE_SALARY_STRUCTURE\');\n    }\n    throw error;\n  }\n};\n\n/**\n * Get salary structures with filters\n * @param {Object} filters - Filter criteria\n * @param {Object} pagination - Pagination options\n * @param {String} tenantId - Tenant ID\n * @returns {Object} Salary structures and pagination info\n */\nconst getSalaryStructures = async (filters, pagination, tenantId) => {\n  try {\n    const query = { tenantId, ...filters };\n    \n    // Handle active filter\n    if (filters.active !== undefined) {\n      query.isActive = filters.active;\n    }\n    \n    // Handle designation filter\n    if (filters.designation) {\n      query.designation = filters.designation;\n    }\n    \n    const salaryStructures = await SalaryStructure.find(query)\n      .sort(pagination.sort || \'-createdAt\')\n      .skip(pagination.skip)\n      .limit(pagination.limit);\n    \n    const total = await SalaryStructure.countDocuments(query);\n    \n    return {\n      salaryStructures,\n      total,\n      page: pagination.page,\n      limit: pagination.limit\n    };\n  } catch (error) {\n    throw new AppError(\'Failed to fetch salary structures\', 500, \'FETCH_SALARY_STRUCTURES_ERROR\');\n  }\n};\n\n/**\n * Get salary structure by ID\n * @param {String} structureId - Salary structure ID\n * @param {String} tenantId - Tenant ID\n * @returns {Object} Salary structure\n */\nconst getSalaryStructureById = async (structureId, tenantId) => {\n  try {\n    const salaryStructure = await SalaryStructure.findOne({ salaryStructureId: structureId, tenantId });\n    \n    if (!salaryStructure) {\n      throw new AppError(\'Salary structure not found\', 404, \'SALARY_STRUCTURE_NOT_FOUND\');\n    }\n    \n    return salaryStructure;\n  } catch (error) {\n    if (error.name === \'CastError\') {\n      throw new AppError(\'Invalid salary structure ID\', 400, \'INVALID_SALARY_STRUCTURE_ID\');\n    }\n    throw error;\n  }\n};\n\n/**\n * Update salary structure\n * @param {String} structureId - Salary structure ID\n * @param {Object} updateData - Update data\n * @param {String} tenantId - Tenant ID\n * @returns {Object} Updated salary structure\n */\nconst updateSalaryStructure = async (structureId, updateData, tenantId) => {\n  try {\n    // Recalculate CTC if components are updated\n    if (updateData.components && updateData.components.earnings) {\n      const totalEarnings = updateData.components.earnings.reduce((sum, component) => sum + (component.amount || 0), 0);\n      updateData.ctc = totalEarnings;\n    }\n    \n    const salaryStructure = await SalaryStructure.findOneAndUpdate(\n      { salaryStructureId: structureId, tenantId },\n      updateData,\n      { new: true, runValidators: true }\n    );\n    \n    if (!salaryStructure) {\n      throw new AppError(\'Salary structure not found\', 404, \'SALARY_STRUCTURE_NOT_FOUND\');\n    }\n    \n    return salaryStructure;\n  } catch (error) {\n    if (error.name === \'CastError\') {\n      throw new AppError(\'Invalid salary structure ID\', 400, \'INVALID_SALARY_STRUCTURE_ID\');\n    }\n    throw error;\n  }\n};\n\n/**\n * Delete salary structure (soft delete)\n * @param {String} structureId - Salary structure ID\n * @param {String} tenantId - Tenant ID\n * @returns {Object} Deletion result\n */\nconst deleteSalaryStructure = async (structureId, tenantId) => {\n  try {\n    const salaryStructure = await SalaryStructure.findOneAndUpdate(\n      { salaryStructureId: structureId, tenantId },\n      { isActive: false },\n      { new: true }\n    );\n    \n    if (!salaryStructure) {\n      throw new AppError(\'Salary structure not found\', 404, \'SALARY_STRUCTURE_NOT_FOUND\');\n    }\n    \n    return {\n      message: \'Salary structure deleted successfully\',\n      salaryStructure\n    };\n  } catch (error) {\n    if (error.name === \'CastError\') {\n      throw new AppError(\'Invalid salary structure ID\', 400, \'INVALID_SALARY_STRUCTURE_ID\');\n    }\n    throw error;\n  }\n};\n\n/**\n * Calculate salary for an employee based on structure\n * @param {String} structureId - Salary structure ID\n * @param {Object} customComponents - Custom components for employee\n * @param {String} tenantId - Tenant ID\n * @returns {Object} Calculated salary details\n */\nconst calculateSalary = async (structureId, customComponents = [], tenantId) => {\n  try {\n    const salaryStructure = await SalaryStructure.findOne({ salaryStructureId: structureId, tenantId });\n    \n    if (!salaryStructure) {\n      throw new AppError(\'Salary structure not found\', 404, \'SALARY_STRUCTURE_NOT_FOUND\');\n    }\n    \n    // Calculate earnings\n    let totalEarnings = 0;\n    const earningsBreakdown = [];\n    \n    // Add standard earnings\n    for (const earning of salaryStructure.components.earnings) {\n      const amount = earning.amount || 0;\n      totalEarnings += amount;\n      earningsBreakdown.push({\n        componentName: earning.componentName,\n        amount\n      });\n    }\n    \n    // Add custom earnings\n    for (const custom of customComponents) {\n      totalEarnings += custom.amount;\n      earningsBreakdown.push({\n        componentName: custom.componentName,\n        amount: custom.amount\n      });\n    }\n    \n    // Calculate deductions\n    let totalDeductions = 0;\n    const deductionsBreakdown = [];\n    \n    for (const deduction of salaryStructure.components.deductions) {\n      // In a real implementation, you would calculate actual deduction amounts\n      // based on formulas or percentages\n      const amount = deduction.amount || 0;\n      totalDeductions += amount;\n      deductionsBreakdown.push({\n        componentName: deduction.componentName,\n        amount\n      });\n    }\n    \n    const netSalary = totalEarnings - totalDeductions;\n    \n    return {\n      grossSalary: totalEarnings,\n      totalDeductions,\n      netSalary,\n      earningsBreakdown,\n      deductionsBreakdown\n    };\n  } catch (error) {\n    throw error;\n  }\n};\n\nmodule.exports = {\n  createSalaryStructure,\n  getSalaryStructures,\n  getSalaryStructureById,\n  updateSalaryStructure,\n  deleteSalaryStructure,\n  calculateSalary\n};\n</create-file>\n</function_calls>'}