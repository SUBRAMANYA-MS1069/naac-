{'role': 'assistant', 'content': 'Let\'s continue creating more services:\n\n<function_calls>\n<create-file file_path="src/services/tax/tdsService.js">\nconst TDSDeduction = require(\'../../models/tax/TDSDeduction\');\nconst { calculateTDS } = require(\'../../utils/calculators/taxCalculator\');\nconst { AppError } = require(\'../../utils/helpers/errorHelper\');\n\n/**\n * Create a new TDS deduction\n * @param {Object} tdsData - TDS deduction data\n * @param {String} tenantId - Tenant ID\n * @returns {Object} Created TDS deduction\n */\nconst createTDSDeduction = async (tdsData, tenantId) => {\n  try {\n    // Add tenantId to TDS data\n    tdsData.tenantId = tenantId;\n    \n    // Calculate TDS amounts\n    const tdsCalculation = calculateTDS(tdsData.grossAmount, tdsData.tdsRate);\n    \n    tdsData.tdsAmount = tdsCalculation.tdsAmount;\n    tdsData.netAmount = tdsCalculation.netAmount;\n    \n    // Create TDS deduction\n    const tdsDeduction = new TDSDeduction(tdsData);\n    await tdsDeduction.save();\n    \n    return tdsDeduction;\n  } catch (error) {\n    if (error.code === 11000) {\n      throw new AppError(\'TDS deduction with this details already exists\', 409, \'DUPLICATE_TDS_DEDUCTION\');\n    }\n    throw error;\n  }\n};\n\n/**\n * Get TDS deductions with filters\n * @param {Object} filters - Filter criteria\n * @param {Object} pagination - Pagination options\n * @param {String} tenantId - Tenant ID\n * @returns {Object} TDS deductions and pagination info\n */\nconst getTDSDeductions = async (filters, pagination, tenantId) => {\n  try {\n    const query = { tenantId, ...filters };\n    \n    // Handle section filter\n    if (filters.section) {\n      query.section = filters.section;\n    }\n    \n    // Handle financial year filter\n    if (filters.financialYear) {\n      query.financialYear = filters.financialYear;\n    }\n    \n    // Handle quarter filter\n    if (filters.quarter) {\n      query.quarter = filters.quarter;\n    }\n    \n    // Handle date range filter\n    if (filters.startDate || filters.endDate) {\n      query.paymentDate = {};\n      if (filters.startDate) {\n        query.paymentDate.$gte = new Date(filters.startDate);\n      }\n      if (filters.endDate) {\n        query.paymentDate.$lte = new Date(filters.endDate);\n      }\n    }\n    \n    const deductions = await TDSDeduction.find(query)\n      .sort(pagination.sort || \'-paymentDate\')\n      .skip(pagination.skip)\n      .limit(pagination.limit);\n    \n    const total = await TDSDeduction.countDocuments(query);\n    \n    return {\n      deductions,\n      total,\n      page: pagination.page,\n      limit: pagination.limit\n    };\n  } catch (error) {\n    throw new AppError(\'Failed to fetch TDS deductions\', 500, \'FETCH_TDS_DEDUCTIONS_ERROR\');\n  }\n};\n\n/**\n * Get TDS deduction by ID\n * @param {String} deductionId - Deduction ID\n * @param {String} tenantId - Tenant ID\n * @returns {Object} TDS deduction\n */\nconst getTDSDeductionById = async (deductionId, tenantId) => {\n  try {\n    const deduction = await TDSDeduction.findOne({ tdsDeductionId: deductionId, tenantId });\n    \n    if (!deduction) {\n      throw new AppError(\'TDS deduction not found\', 404, \'TDS_DEDUCTION_NOT_FOUND\');\n    }\n    \n    return deduction;\n  } catch (error) {\n    if (error.name === \'CastError\') {\n      throw new AppError(\'Invalid TDS deduction ID\', 400, \'INVALID_TDS_DEDUCTION_ID\');\n    }\n    throw error;\n  }\n};\n\n/**\n * Update TDS deduction\n * @param {String} deductionId - Deduction ID\n * @param {Object} updateData - Update data\n * @param {String} tenantId - Tenant ID\n * @returns {Object} Updated TDS deduction\n */\nconst updateTDSDeduction = async (deductionId, updateData, tenantId) => {\n  try {\n    // Recalculate TDS if gross amount or rate is updated\n    if (updateData.grossAmount !== undefined || updateData.tdsRate !== undefined) {\n      const grossAmount = updateData.grossAmount || (await TDSDeduction.findOne({ tdsDeductionId: deductionId, tenantId }))?.grossAmount;\n      const tdsRate = updateData.tdsRate || (await TDSDeduction.findOne({ tdsDeductionId: deductionId, tenantId }))?.tdsRate;\n      \n      const tdsCalculation = calculateTDS(grossAmount, tdsRate);\n      \n      updateData.tdsAmount = tdsCalculation.tdsAmount;\n      updateData.netAmount = tdsCalculation.netAmount;\n    }\n    \n    const deduction = await TDSDeduction.findOneAndUpdate(\n      { tdsDeductionId: deductionId, tenantId },\n      updateData,\n      { new: true, runValidators: true }\n    );\n    \n    if (!deduction) {\n      throw new AppError(\'TDS deduction not found\', 404, \'TDS_DEDUCTION_NOT_FOUND\');\n    }\n    \n    return deduction;\n  } catch (error) {\n    if (error.name === \'CastError\') {\n      throw new AppError(\'Invalid TDS deduction ID\', 400, \'INVALID_TDS_DEDUCTION_ID\');\n    }\n    throw error;\n  }\n};\n\n/**\n * Delete TDS deduction (soft delete)\n * @param {String} deductionId - Deduction ID\n * @param {String} tenantId - Tenant ID\n * @returns {Object} Deletion result\n */\nconst deleteTDSDeduction = async (deductionId, tenantId) => {\n  try {\n    const deduction = await TDSDeduction.findOneAndUpdate(\n      { tdsDeductionId: deductionId, tenantId },\n      { isActive: false },\n      { new: true }\n    );\n    \n    if (!deduction) {\n      throw new AppError(\'TDS deduction not found\', 404, \'TDS_DEDUCTION_NOT_FOUND\');\n    }\n    \n    return {\n      message: \'TDS deduction deleted successfully\',\n      deduction\n    };\n  } catch (error) {\n    if (error.name === \'CastError\') {\n      throw new AppError(\'Invalid TDS deduction ID\', 400, \'INVALID_TDS_DEDUCTION_ID\');\n    }\n    throw error;\n  }\n};\n\n/**\n * Get TDS summary by financial year\n * @param {String} financialYear - Financial year\n * @param {String} tenantId - Tenant ID\n * @returns {Object} TDS summary\n */\nconst getTDSSummary = async (financialYear, tenantId) => {\n  try {\n    const deductions = await TDSDeduction.find({ \n      tenantId, \n      financialYear,\n      isActive: true\n    });\n    \n    const totalGrossAmount = deductions.reduce((sum, d) => sum + d.grossAmount, 0);\n    const totalTDSDeducted = deductions.reduce((sum, d) => sum + d.tdsAmount, 0);\n    const totalNetAmount = deductions.reduce((sum, d) => sum + d.netAmount, 0);\n    \n    // Group by section\n    const sectionWise = {};\n    deductions.forEach(deduction => {\n      if (!sectionWise[deduction.section]) {\n        sectionWise[deduction.section] = {\n          count: 0,\n          grossAmount: 0,\n          tdsAmount: 0,\n          netAmount: 0\n        };\n      }\n      \n      sectionWise[deduction.section].count++;\n      sectionWise[deduction.section].grossAmount += deduction.grossAmount;\n      sectionWise[deduction.section].tdsAmount += deduction.tdsAmount;\n      sectionWise[deduction.section].netAmount += deduction.netAmount;\n    });\n    \n    return {\n      financialYear,\n      totalDeductions: deductions.length,\n      totalGrossAmount,\n      totalTDSDeducted,\n      totalNetAmount,\n      sectionWise\n    };\n  } catch (error) {\n    throw new AppError(\'Failed to get TDS summary\', 500, \'TDS_SUMMARY_ERROR\');\n  }\n};\n\nmodule.exports = {\n  createTDSDeduction,\n  getTDSDeductions,\n  getTDSDeductionById,\n  updateTDSDeduction,\n  deleteTDSDeduction,\n  getTDSSummary\n};\n</create-file>\n</function_calls>'}