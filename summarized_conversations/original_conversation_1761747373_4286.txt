{'role': 'assistant', 'content': 'Let\'s continue creating the fee-related services:\n\n<function_calls>\n<create-file file_path="src/services/fees/feeStructureService.js">\nconst FeeStructure = require(\'../../models/fees/FeeStructure\');\nconst { AppError } = require(\'../../utils/helpers/errorHelper\');\n\n/**\n * Create a new fee structure\n * @param {Object} feeStructureData - Fee structure data\n * @param {String} tenantId - Tenant ID\n * @returns {Object} Created fee structure\n */\nconst createFeeStructure = async (feeStructureData, tenantId) => {\n  try {\n    // Add tenantId to fee structure data\n    feeStructureData.tenantId = tenantId;\n    \n    // Calculate total fee\n    const totalFee = feeStructureData.components.reduce((sum, component) => sum + component.amount, 0);\n    feeStructureData.totalFee = totalFee;\n    \n    // Create fee structure\n    const feeStructure = new FeeStructure(feeStructureData);\n    await feeStructure.save();\n    \n    return feeStructure;\n  } catch (error) {\n    if (error.code === 11000) {\n      throw new AppError(\'Fee structure with this name already exists\', 409, \'DUPLICATE_FEE_STRUCTURE\');\n    }\n    throw error;\n  }\n};\n\n/**\n * Get fee structures with filters\n * @param {Object} filters - Filter criteria\n * @param {Object} pagination - Pagination options\n * @param {String} tenantId - Tenant ID\n * @returns {Object} Fee structures and pagination info\n */\nconst getFeeStructures = async (filters, pagination, tenantId) => {\n  try {\n    const query = { tenantId, ...filters };\n    \n    // Handle active filter\n    if (filters.active !== undefined) {\n      query.isActive = filters.active;\n    }\n    \n    // Handle academic year filter\n    if (filters.academicYear) {\n      query.academicYear = filters.academicYear;\n    }\n    \n    // Handle program filter\n    if (filters.programId) {\n      query.programId = filters.programId;\n    }\n    \n    const feeStructures = await FeeStructure.find(query)\n      .sort(pagination.sort || \'-createdAt\')\n      .skip(pagination.skip)\n      .limit(pagination.limit);\n    \n    const total = await FeeStructure.countDocuments(query);\n    \n    return {\n      feeStructures,\n      total,\n      page: pagination.page,\n      limit: pagination.limit\n    };\n  } catch (error) {\n    throw new AppError(\'Failed to fetch fee structures\', 500, \'FETCH_FEE_STRUCTURES_ERROR\');\n  }\n};\n\n/**\n * Get fee structure by ID\n * @param {String} structureId - Fee structure ID\n * @param {String} tenantId - Tenant ID\n * @returns {Object} Fee structure\n */\nconst getFeeStructureById = async (structureId, tenantId) => {\n  try {\n    const feeStructure = await FeeStructure.findOne({ feeStructureId: structureId, tenantId });\n    \n    if (!feeStructure) {\n      throw new AppError(\'Fee structure not found\', 404, \'FEE_STRUCTURE_NOT_FOUND\');\n    }\n    \n    return feeStructure;\n  } catch (error) {\n    if (error.name === \'CastError\') {\n      throw new AppError(\'Invalid fee structure ID\', 400, \'INVALID_FEE_STRUCTURE_ID\');\n    }\n    throw error;\n  }\n};\n\n/**\n * Update fee structure\n * @param {String} structureId - Fee structure ID\n * @param {Object} updateData - Update data\n * @param {String} tenantId - Tenant ID\n * @returns {Object} Updated fee structure\n */\nconst updateFeeStructure = async (structureId, updateData, tenantId) => {\n  try {\n    // Recalculate total fee if components are updated\n    if (updateData.components) {\n      const totalFee = updateData.components.reduce((sum, component) => sum + component.amount, 0);\n      updateData.totalFee = totalFee;\n    }\n    \n    const feeStructure = await FeeStructure.findOneAndUpdate(\n      { feeStructureId: structureId, tenantId },\n      updateData,\n      { new: true, runValidators: true }\n    );\n    \n    if (!feeStructure) {\n      throw new AppError(\'Fee structure not found\', 404, \'FEE_STRUCTURE_NOT_FOUND\');\n    }\n    \n    return feeStructure;\n  } catch (error) {\n    if (error.name === \'CastError\') {\n      throw new AppError(\'Invalid fee structure ID\', 400, \'INVALID_FEE_STRUCTURE_ID\');\n    }\n    throw error;\n  }\n};\n\n/**\n * Delete fee structure (soft delete)\n * @param {String} structureId - Fee structure ID\n * @param {...\n The full message content is stored at /workspace/summarized_conversations/original_conversation_1761747277_8033.txt'}