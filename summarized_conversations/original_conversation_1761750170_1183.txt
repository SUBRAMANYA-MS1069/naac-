{'role': 'assistant', 'content': 'Let\'s continue creating more services:\n\n<function_calls>\n<create-file file_path="src/services/expenditure/billService.js">\nconst Bill = require(\'../../models/expenditure/Bill\');\nconst Vendor = require(\'../../models/expenditure/Vendor\');\nconst PurchaseOrder = require(\'../../models/expenditure/PurchaseOrder\');\nconst { AppError } = require(\'../../utils/helpers/errorHelper\');\n\n/**\n * Create a new bill\n * @param {Object} billData - Bill data\n * @param {String} tenantId - Tenant ID\n * @param {String} userId - User ID\n * @returns {Object} Created bill\n */\nconst createBill = async (billData, tenantId, userId) => {\n  try {\n    // Add tenantId to bill data\n    billData.tenantId = tenantId;\n    \n    // Check if vendor exists and is active\n    const vendor = await Vendor.findOne({ \n      vendorId: billData.vendorId, \n      tenantId,\n      isActive: true \n    });\n    \n    if (!vendor) {\n      throw new AppError(\'Vendor not found or inactive\', 404, \'VENDOR_NOT_FOUND\');\n    }\n    \n    // Check if PO exists (if provided)\n    if (billData.purchaseOrderId) {\n      const po = await PurchaseOrder.findOne({ \n        poId: billData.purchaseOrderId, \n        tenantId \n      });\n      \n      if (!po) {\n        throw new AppError(\'Purchase order not found\', 404, \'PO_NOT_FOUND\');\n      }\n    }\n    \n    // Calculate totals\n    let subtotal = 0;\n    let taxTotal = 0;\n    \n    for (const item of billData.lineItems) {\n      const itemTotal = item.quantity * item.unitPrice;\n      const itemTax = itemTotal * (item.taxRate / 100);\n      \n      item.totalAmount = itemTotal + itemTax;\n      subtotal += itemTotal;\n      taxTotal += itemTax;\n    }\n    \n    billData.subtotal = subtotal;\n    billData.taxTotal = taxTotal;\n    billData.totalAmount = subtotal + taxTotal + (billData.otherCharges || 0);\n    billData.balanceAmount = billData.totalAmount;\n    \n    // Create bill\n    const bill = new Bill(billData);\n    await bill.save();\n    \n    return bill;\n  } catch (error) {\n    if (error.code === 11000) {\n      throw new AppError(\'Bill with this number already exists\', 409, \'DUPLICATE_BILL\');\n    }\n    throw error;\n  }\n};\n\n/**\n * Get bills with filters\n * @param {Object} filters - Filter criteria\n * @param {Object} pagination - Pagination options\n * @param {String} tenantId - Tenant ID\n * @returns {Object} Bills and pagination info\n */\nconst getBills = async (filters, pagination, tenantId) => {\n  try {\n    const query = { tenantId, ...filters };\n    \n    // Handle vendor filter\n    if (filters.vendorId) {\n      query.vendorId = filters.vendorId;\n    }\n    \n    // Handle status filter\n    if (filters.status) {\n      query.status = filters.status;\n    }\n    \n    // Handle bill type filter\n    if (filters.billType) {\n      query.billType = filters.billType;\n    }\n    \n    // Handle date range filter\n    if (filters.startDate || filters.endDate) {\n      query.billDate = {};\n      if (filters.startDate) {\n        query.billDate.$gte = new Date(filters.startDate);\n      }\n      if (filters.endDate) {\n        query.billDate.$lte = new Date(filters.endDate);\n      }\n    }\n    \n    const bills = await Bill.find(query)\n      .sort(pagination.sort || \'-billDate\')\n      .skip(pagination.skip)\n      .limit(pagination.limit)\n      .populate(\'vendorId\', \'vendorName vendorCode\')\n      .populate(\'purchaseOrderId\', \'poNumber\');\n    \n    const total = await Bill.countDocuments(query);\n    \n    return {\n      bills,\n      total,\n      page: pagination.page,\n      limit: pagination.limit\n    };\n  } catch (error) {\n    throw new AppError(\'Failed to fetch bills\', 500, \'FETCH_BILLS_ERROR\');\n  }\n};\n\n/**\n * Get bill by ID\n * @param {String} billId - Bill ID\n * @param {String} tenantId - Tenant ID\n * @returns {Object} Bill\n */\nconst getBillById = async (billId, tenantId) => {\n  try {\n    const bill = await Bill.findOne({ billId, tenantId })\n      .populate(\'vendorId\', \'vendorName vendorCode contactPerson address\')\n      .populate(\'purchaseOrderId\', \'poNumber poDate\');\n    \n    if (!bill) {\n      throw new AppError(\'Bill not found\', 404, \'BILL_NOT_FOUND\');\n    }\n    \n    return bill;\n  } ...\n The full message content is stored at /workspace/summarized_conversations/original_conversation_1761750016_1791.txt'}