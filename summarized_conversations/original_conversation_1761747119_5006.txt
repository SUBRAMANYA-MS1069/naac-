{'role': 'assistant', 'content': 'Let\'s continue creating more services:\n\n<function_calls>\n<create-file file_path="src/services/tax/gstService.js">\nconst GSTTransaction = require(\'../../models/tax/GSTTransaction\');\nconst { calculateGST } = require(\'../../utils/calculators/taxCalculator\');\nconst { AppError } = require(\'../../utils/helpers/errorHelper\');\n\n/**\n * Create a new GST transaction\n * @param {Object} gstData - GST transaction data\n * @param {String} tenantId - Tenant ID\n * @returns {Object} Created GST transaction\n */\nconst createGSTTransaction = async (gstData, tenantId) => {\n  try {\n    // Add tenantId to GST data\n    gstData.tenantId = tenantId;\n    \n    // Calculate GST amounts\n    const gstCalculation = calculateGST(\n      gstData.taxableAmount,\n      gstData.gstRate,\n      gstData.placeOfSupply === \'InterState\' ? \'InterState\' : \'IntraState\'\n    );\n    \n    gstData.cgst = gstCalculation.cgst;\n    gstData.sgst = gstCalculation.sgst;\n    gstData.igst = gstCalculation.igst;\n    gstData.totalGST = gstCalculation.totalGST;\n    gstData.totalAmount = gstData.taxableAmount + gstCalculation.totalGST;\n    \n    // Create GST transaction\n    const gstTransaction = new GSTTransaction(gstData);\n    await gstTransaction.save();\n    \n    return gstTransaction;\n  } catch (error) {\n    if (error.code === 11000) {\n      throw new AppError(\'GST transaction with this invoice number already exists\', 409, \'DUPLICATE_GST_TRANSACTION\');\n    }\n    throw error;\n  }\n};\n\n/**\n * Get GST transactions with filters\n * @param {Object} filters - Filter criteria\n * @param {Object} pagination - Pagination options\n * @param {String} tenantId - Tenant ID\n * @returns {Object} GST transactions and pagination info\n */\nconst getGSTTransactions = async (filters, pagination, tenantId) => {\n  try {\n    const query = { tenantId, ...filters };\n    \n    // Handle transaction type filter\n    if (filters.transactionType) {\n      query.transactionType = filters.transactionType;\n    }\n    \n    // Handle financial year filter\n    if (filters.financialYear) {\n      query.financialYear = filters.financialYear;\n    }\n    \n    // Handle quarter filter\n    if (filters.quarter) {\n      query.quarter = filters.quarter;\n    }\n    \n    // Handle date range filter\n    if (filters.startDate || filters.endDate) {\n      query.invoiceDate = {};\n      if (filters.startDate) {\n        query.invoiceDate.$gte = new Date(filters.startDate);\n      }\n      if (filters.endDate) {\n        query.invoiceDate.$lte = new Date(filters.endDate);\n      }\n    }\n    \n    const transactions = await GSTTransaction.find(query)\n      .sort(pagination.sort || \'-invoiceDate\')\n      .skip(pagination.skip)\n      .limit(pagination.limit);\n    \n    const total = await GSTTransaction.countDocuments(query);\n    \n    return {\n      transactions,\n      total,\n      page: pagination.page,\n      limit: pagination.limit\n    };\n  } catch (error) {\n    throw new AppError(\'Failed to fetch GST transactions\', 500, \'FETCH_GST_TRANSACTIONS_ERROR\');\n  }\n};\n\n/**\n * Get GST transaction by ID\n * @param {String} transactionId - Transaction ID\n * @param {String} tenantId - Tenant ID\n * @returns {Object} GST transaction\n */\nconst getGSTTransactionById = async (transactionId, tenantId) => {\n  try {\n    const transaction = await GSTTransaction.findOne({ gstTransactionId: transactionId, tenantId });\n    \n    if (!transaction) {\n      throw new AppError(\'GST transaction not found\', 404, \'GST_TRANSACTION_NOT_FOUND\');\n    }\n    \n    return transaction;\n  } catch (error) {\n    if (error.name === \'CastError\') {\n      throw new AppError(\'Invalid GST transaction ID\', 400, \'INVALID_GST_TRANSACTION_ID\');\n    }\n    throw error;\n  }\n};\n\n/**\n * Update GST transaction\n * @param {String} transactionId - Transaction ID\n * @param {Object} updateData - Update data\n * @param {String} tenantId - Tenant ID\n * @returns {Object} Updated GST transaction\n */\nconst updateGSTTransaction = async (transactionId, updateData, tenantId) => {\n  try {\n    // Recalculate GST if taxable amount or rate is updated\n    if (updateData.taxableAmount !== undefined || updateData.gstRate !== undefined) {\n      const taxableAmount = updateData.taxableAmount || (await GSTTransaction.findOne({ gstTransactionId: transactionId, tenantId }))?.taxableAmount;\n      const gstRate = updateData.gstRate || (await GSTTransaction.findOne({ gstTransactionId: transactionId, tenantId }))?.gstRate;\n      const placeOfSupply = updateData.placeOfSupply || (await GSTTransaction.findOne({ gstTransactionId: transactionId, tenantId }))?.placeOfSupply;\n      \n      const gstCalculation = calculateGST(\n        taxableAmount,\n        gstRate,\n        placeOfSupply === \'InterState\' ? \'InterState\' : \'IntraState\'\n      );\n      \n      updateData.cgst = gstCalculation.cgst;\n      updateData.sgst = gstCalculation.sgst;\n      updateData.igst = gstCalculation.igst;\n      updateData.totalGST = gstCalculation.totalGST;\n      updateData.totalAmount = taxableAmount + gstCalculation.totalGST;\n    }\n    \n    const transaction = await GSTTransaction.findOneAndUpdate(\n      { gstTransactionId: transactionId, tenantId },\n      updateData,\n      { new: true, runValidators: true }\n    );\n    \n    if (!transaction) {\n      throw new AppError(\'GST transaction not found\', 404, \'GST_TRANSACTION_NOT_FOUND\');\n    }\n    \n    return transaction;\n  } catch (error) {\n    if (error.name === \'CastError\') {\n      throw new AppError(\'Invalid GST transaction ID\', 400, \'INVALID_GST_TRANSACTION_ID\');\n    }\n    throw error;\n  }\n};\n\n/**\n * Delete GST transaction (soft delete)\n * @param {String} transactionId - Transaction ID\n * @param {String} tenantId - Tenant ID\n * @returns {Object} Deletion result\n */\nconst deleteGSTTransaction = async (transactionId, tenantId) => {\n  try {\n    const transaction = await GSTTransaction.findOneAndUpdate(\n      { gstTransactionId: transactionId, tenantId },\n      { isActive: false },\n      { new: true }\n    );\n    \n    if (!transaction) {\n      throw new AppError(\'GST transaction not found\', 404, \'GST_TRANSACTION_NOT_FOUND\');\n    }\n    \n    return {\n      message: \'GST transaction deleted successfully\',\n      transaction\n    };\n  } catch (error) {\n    if (error.name === \'CastError\') {\n      throw new AppError(\'Invalid GST transaction ID\', 400, \'INVALID_GST_TRANSACTION_ID\');\n    }\n    throw error;\n  }\n};\n\n/**\n * Get GSTR1 filing status\n * @param {String} financialYear - Financial year\n * @param {String} quarter - Quarter\n * @param {String} tenantId - Tenant ID\n * @returns {Object} Filing status\n */\nconst getGSTR1FilingStatus = async (financialYear, quarter, tenantId) => {\n  try {\n    const transactions = await GSTTransaction.find({ \n      tenantId, \n      financialYear, \n      quarter \n    });\n    \n    const totalTransactions = transactions.length;\n    const filedTransactions = transactions.filter(t => t.gstr1FilingStatus === \'Filed\').length;\n    \n    return {\n      financialYear,\n      quarter,\n      totalTransactions,\n      filedTransactions,\n      pendingTransactions: totalTransactions - filedTransactions,\n      filingPercentage: totalTransactions > 0 ? (filedTransactions / totalTransactions) * 100 : 0\n    };\n  } catch (error) {\n    throw new AppError(\'Failed to get GSTR1 filing status\', 500, \'GSTR1_FILING_STATUS_ERROR\');\n  }\n};\n\nmodule.exports = {\n  createGSTTransaction,\n  getGSTTransactions,\n  getGSTTransactionById,\n  updateGSTTransaction,\n  deleteGSTTransaction,\n  getGSTR1FilingStatus\n};\n</create-file>\n</function_calls>'}