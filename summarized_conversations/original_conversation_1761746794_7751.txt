{'role': 'assistant', 'content': 'Let\'s continue creating more services:\n\n<function_calls>\n<create-file file_path="src/services/fees/scholarshipService.js">\nconst Scholarship = require(\'../../models/fees/Scholarship\');\nconst ScholarshipApplication = require(\'../../models/fees/ScholarshipApplication\');\nconst ScholarshipDisbursement = require(\'../../models/fees/ScholarshipDisbursement\');\nconst { AppError } = require(\'../../utils/helpers/errorHelper\');\n\n/**\n * Create a new scholarship\n * @param {Object} scholarshipData - Scholarship data\n * @param {String} tenantId - Tenant ID\n * @returns {Object} Created scholarship\n */\nconst createScholarship = async (scholarshipData, tenantId) => {\n  try {\n    // Add tenantId to scholarship data\n    scholarshipData.tenantId = tenantId;\n    \n    // Create scholarship\n    const scholarship = new Scholarship(scholarshipData);\n    await scholarship.save();\n    \n    return scholarship;\n  } catch (error) {\n    if (error.code === 11000) {\n      throw new AppError(\'Scholarship with this name already exists\', 409, \'DUPLICATE_SCHOLARSHIP\');\n    }\n    throw error;\n  }\n};\n\n/**\n * Get scholarships with filters\n * @param {Object} filters - Filter criteria\n * @param {Object} pagination - Pagination options\n * @param {String} tenantId - Tenant ID\n * @returns {Object} Scholarships and pagination info\n */\nconst getScholarships = async (filters, pagination, tenantId) => {\n  try {\n    const query = { tenantId, ...filters };\n    \n    // Handle active filter\n    if (filters.active !== undefined) {\n      query.isActive = filters.active;\n    }\n    \n    // Handle academic year filter\n    if (filters.academicYear) {\n      query.academicYear = filters.academicYear;\n    }\n    \n    // Handle scholarship type filter\n    if (filters.scholarshipType) {\n      query.scholarshipType = filters.scholarshipType;\n    }\n    \n    const scholarships = await Scholarship.find(query)\n      .sort(pagination.sort || \'-createdAt\')\n      .skip(pagination.skip)\n      .limit(pagination.limit);\n    \n    const total = await Scholarship.countDocuments(query);\n    \n    return {\n      scholarships,\n      total,\n      page: pagination.page,\n      limit: pagination.limit\n    };\n  } catch (error) {\n    throw new AppError(\'Failed to fetch scholarships\', 500, \'FETCH_SCHOLARSHIPS_ERROR\');\n  }\n};\n\n/**\n * Get scholarship by ID\n * @param {String} scholarshipId - Scholarship ID\n * @param {String} tenantId - Tenant ID\n * @returns {Object} Scholarship\n */\nconst getScholarshipById = async (scholarshipId, tenantId) => {\n  try {\n    const scholarship = await Scholarship.findOne({ scholarshipId, tenantId });\n    \n    if (!scholarship) {\n      throw new AppError(\'Scholarship not found\', 404, \'SCHOLARSHIP_NOT_FOUND\');\n    }\n    \n    return scholarship;\n  } catch (error) {\n    if (error.name === \'CastError\') {\n      throw new AppError(\'Invalid scholarship ID\', 400, \'INVALID_SCHOLARSHIP_ID\');\n    }\n    throw error;\n  }\n};\n\n/**\n * Update scholarship\n * @param {String} scholarshipId - Scholarship ID\n * @param {Object} updateData - Update data\n * @param {String} tenantId - Tenant ID\n * @returns {Object} Updated scholarship\n */\nconst updateScholarship = async (scholarshipId, updateData, tenantId) => {\n  try {\n    const scholarship = await Scholarship.findOneAndUpdate(\n      { scholarshipId, tenantId },\n      updateData,\n      { new: true, runValidators: true }\n    );\n    \n    if (!scholarship) {\n      throw new AppError(\'Scholarship not found\', 404, \'SCHOLARSHIP_NOT_FOUND\');\n    }\n    \n    return scholarship;\n  } catch (error) {\n    if (error.name === \'CastError\') {\n      throw new AppError(\'Invalid scholarship ID\', 400, \'INVALID_SCHOLARSHIP_ID\');\n    }\n    throw error;\n  }\n};\n\n/**\n * Delete scholarship (soft delete)\n * @param {String} scholarshipId - Scholarship ID\n * @param {String} tenantId - Tenant ID\n * @returns {Object} Deletion result\n */\nconst deleteScholarship = async (scholarshipId, tenantId) => {\n  try {\n    const scholarship = await Scholarship.findOneAndUpdate(\n      { scholarshipId, tenantId },\n      { isActive: false },\n      { new: true }\n    );\n    \n    if (!scholarship) {\n      throw new AppError(\'Scholarship not found\', 404, \'SCHOLARSHIP_NOT_FOUND\');\n    }\n    \n    return {\n      message: \'Scholarship deleted successfully\',\n      scholarship\n    };\n  } catch (error) {\n    if (error.name === \'CastError\') {\n      throw new AppError(\'Invalid scholarship ID\', 400, \'INVALID_SCHOLARSHIP_ID\');\n    }\n    throw error;\n  }\n};\n\n/**\n * Apply for scholarship\n * @param {Object} applicationData - Application data\n * @param {String} tenantId - Tenant ID\n * @param {String} studentId - Student ID\n * @returns {Object} Created application\n */\nconst applyForScholarship = async (applicationData, tenantId, studentId) => {\n  try {\n    // Add tenantId and studentId to application data\n    applicationData.tenantId = tenantId;\n    applicationData.studentId = studentId;\n    \n    // Check if scholarship exists and is active\n    const scholarship = await Scholarship.findOne({ \n      scholarshipId: applicationData.scholarshipId, \n      tenantId,\n      isActive: true \n    });\n    \n    if (!scholarship) {\n      throw new AppError(\'Scholarship not found or inactive\', 404, \'SCHOLARSHIP_NOT_FOUND\');\n    }\n    \n    // Check if application already exists\n    const existingApplication = await ScholarshipApplication.findOne({\n      scholarshipId: applicationData.scholarshipId,\n      studentId,\n      tenantId\n    });\n    \n    if (existingApplication) {\n      throw new AppError(\'Application already exists for this scholarship\', 409, \'DUPLICATE_APPLICATION\');\n    }\n    \n    // Create application\n    const application = new ScholarshipApplication(applicationData);\n    await application.save();\n    \n    return application;\n  } catch (error) {\n    if (error.code === 11000) {\n      throw new AppError(\'Application already exists\', 409, \'DUPLICATE_APPLICATION\');\n    }\n    throw error;\n  }\n};\n\n/**\n * Get scholarship applications\n * @param {Object} filters - Filter criteria\n * @param {Object} pagination - Pagination options\n * @param {String} tenantId - Tenant ID\n * @returns {Object} Applications and pagination info\n */\nconst getScholarshipApplications = async (filters, pagination, tenantId) => {\n  try {\n    const query = { tenantId, ...filters };\n    \n    // Handle scholarship filter\n    if (filters.scholarshipId) {\n      query.scholarshipId = filters.scholarshipId;\n    }\n    \n    // Handle student filter\n    if (filters.studentId) {\n      query.studentId = filters.studentId;\n    }\n    \n    // Handle status filter\n    if (filters.status) {\n      query.status = filters.status;\n    }\n    \n    const applications = await ScholarshipApplication.find(query)\n      .sort(pagination.sort || \'-applicationDate\')\n      .skip(pagination.skip)\n      .limit(pagination.limit)\n      .populate(\'scholarshipId\', \'scholarshipName scholarshipType\')\n      .populate(\'studentId\', \'name studentCode\');\n    \n    const total = await ScholarshipApplication.countDocuments(query);\n    \n    return {\n      applications,\n      total,\n      page: pagination.page,\n      limit: pagination.limit\n    };\n  } catch (error) {\n    throw new AppError(\'Failed to fetch scholarship applications\', 500, \'FETCH_APPLICATIONS_ERROR\');\n  }\n};\n\n/**\n * Update scholarship application\n * @param {String} applicationId - Application ID\n * @param {Object} updateData - Update data\n * @param {String} tenantId - Tenant ID\n * @returns {Object} Updated application\n */\nconst updateScholarshipApplication = async (applicationId, updateData, tenantId) => {\n  try {\n    const application = await ScholarshipApplication.findOneAndUpdate(\n      { scholarshipApplicationId: applicationId, tenantId },\n      updateData,\n      { new: true, runValidators: true }\n    );\n    \n    if (!application) {\n      throw new AppError(\'Scholarship application not found\', 404, \'APPLICATION_NOT_FOUND\');\n    }\n    \n    return application;\n  } catch (error) {\n    if (error.name === \'CastError\') {\n      throw new AppError(\'Invalid application ID\', 400, \'INVALID_APPLICATION_ID\');\n    }\n    throw error;\n  }\n};\n\n/**\n * Disburse scholarship\n * @param {Object} disbursementData - Disbursement data\n * @param {String} tenantId - Tenant ID\n * @param {String} userId - User ID\n * @returns {Object} Created disbursement\n */\nconst disburseScholarship = async (disbursementData, tenantId, userId) => {\n  try {\n    // Add tenantId and disbursedBy to disbursement data\n    disbursementData.tenantId = tenantId;\n    disbursementData.disbursedBy = userId;\n    \n    // Check if application exists and is approved\n    const application = await ScholarshipApplication.findOne({\n      scholarshipApplicationId: disbursementData.applicationId,\n      tenantId,\n      status: \'Approved\'\n    });\n    \n    if (!application) {\n      throw new AppError(\'Approved application not found\', 404, \'APPLICATION_NOT_FOUND\');\n    }\n    \n    // Create disbursement\n    const disbursement = new ScholarshipDisbursement(disbursementData);\n    await disbursement.save();\n    \n    return disbursement;\n  } catch (error) {\n    if (error.code === 11000) {\n      throw new AppError(\'Disbursement already exists\', 409, \'DUPLICATE_DISBURSEMENT\');\n    }\n    throw error;\n  }\n};\n\nmodule.exports = {\n  createScholarship,\n  getScholarships,\n  getScholarshipById,\n  updateScholarship,\n  deleteScholarship,\n  applyForScholarship,\n  getScholarshipApplications,\n  updateScholarshipApplication,\n  disburseScholarship\n};\n</create-file>\n</function_calls>'}